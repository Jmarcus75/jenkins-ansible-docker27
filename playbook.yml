---
- name: DÃ©ployer l'application Docker
  hosts: all
  become: yes
  gather_facts: no

  tasks:
    - name: Pull l'image Docker depuis le registry
      community.docker.docker_image:
        name: "{{ image }}"
        source: pull
        force_source: yes

    - name: Supprimer l'ancien conteneur s'il existe
      community.docker.docker_container:
        name: "{{ service }}"
        state: absent
        force_kill: yes

    - name: Lancer le conteneur
      community.docker.docker_container:
        name: "{{ service }}"
        image: "{{ image }}"
        state: started
        restart_policy: always
        ports:
          - "8081:8080"
        env:
          TZ: "Europe/Paris"
